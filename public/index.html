<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SMS API - Y√∂netim Paneli</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .stat {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
    }
    .stat-label {
      font-size: 12px;
      opacity: 0.9;
      margin-top: 5px;
    }
    .panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .panel h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      color: #333;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 13px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 13px;
      font-family: inherit;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    .char-count {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: transform 0.2s;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    .btn-danger {
      background: #ff6b6b;
    }
    .sms-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sms-info {
      flex: 1;
    }
    .sms-phone {
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    .sms-message {
      color: #666;
      font-size: 13px;
      margin-bottom: 5px;
    }
    .sms-time {
      font-size: 12px;
      color: #999;
    }
    .sms-actions {
      display: flex;
      gap: 5px;
      margin-left: 15px;
    }
    .message {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 13px;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }
    .tab-btn {
      padding: 10px 15px;
      background: none;
      border: none;
      color: #999;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    .tab-btn.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .template-item {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .template-name {
      font-weight: 600;
      color: #333;
    }
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üì± Kendi SMS API'nƒ±z</h1>
      <p style="color: #666; font-size: 13px;">Mesajlarƒ± kaydedin, takip edin ve y√∂netin</p>
      <div class="stats" id="stats"></div>
    </div>

    <div class="panel">
      <div id="message"></div>
      
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('send')">SMS G√∂nder</button>
        <button class="tab-btn" onclick="switchTab('history')">Ge√ßmi≈ü</button>
        <button class="tab-btn" onclick="switchTab('templates')">≈ûablonlar</button>
      </div>

      <!-- Send Tab -->
      <div id="send" class="tab-content active">
        <h2>SMS G√∂nder</h2>
        
        <div class="form-group">
          <label>Telefon Numarasƒ±</label>
          <input type="tel" id="phone" placeholder="+90 5XX XXX XX XX">
        </div>

        <div class="form-group">
          <label>Mesaj</label>
          <textarea id="message-text" placeholder="Mesajƒ±nƒ±z..."></textarea>
          <div class="char-count">
            <span id="charCount">0</span> / 160 karakter
          </div>
        </div>

        <button class="btn" onclick="sendSMS()">üì§ SMS G√∂nder</button>
      </div>

      <!-- History Tab -->
      <div id="history" class="tab-content">
        <h2>SMS Ge√ßmi≈üi</h2>
        <button class="btn btn-secondary" style="margin-bottom: 15px;" onclick="loadHistory()">üîÑ Yenile</button>
        <button class="btn btn-danger" style="margin-bottom: 15px;" onclick="clearAllSMS()">üóëÔ∏è T√ºm SMS'i Sil</button>
        <div id="historyList" class="empty-state">Y√ºkleniyor...</div>
      </div>

      <!-- Templates Tab -->
      <div id="templates" class="tab-content">
        <h2>Mesaj ≈ûablonlarƒ±</h2>
        
        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
          <div class="form-group">
            <label>≈ûablon Adƒ±</label>
            <input type="text" id="templateName" placeholder="√ñrn: Ho≈ü Geldiniz">
          </div>

          <div class="form-group">
            <label>Mesaj</label>
            <textarea id="templateMessage" placeholder="Mesaj ≈üablonu..."></textarea>
          </div>

          <button class="btn" onclick="saveTemplate()">üíæ ≈ûablonu Kaydet</button>
        </div>

        <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Kaydedilen ≈ûablonlar</h3>
        <div id="templatesList" class="empty-state">≈ûablon yok</div>
      </div>
    </div>
  </div>

  <script>
    const messageEl = document.getElementById('message');
    const charCountEl = document.getElementById('charCount');
    const messageTextEl = document.getElementById('message-text');
    const phoneEl = document.getElementById('phone');

    messageTextEl.addEventListener('input', function() {
      charCountEl.textContent = this.value.length;
      if (this.value.length > 160) {
        this.value = this.value.substring(0, 160);
      }
    });

    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');

      if (tab === 'history') loadHistory();
      if (tab === 'templates') loadTemplates();
    }

    function showMessage(text, type = 'success') {
      messageEl.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => messageEl.innerHTML = '', 4000);
    }

    async function sendSMS() {
      const phone = phoneEl.value.trim();
      const message = messageTextEl.value.trim();

      if (!phone || !message) {
        showMessage('‚ùå Telefon ve mesaj gerekli', 'error');
        return;
      }

      try {
        const res = await fetch('/api/sms/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, message })
        });

        const data = await res.json();
        if (data.success) {
          showMessage(`‚úÖ ${data.message}`, 'success');
          phoneEl.value = '';
          messageTextEl.value = '';
          charCountEl.textContent = '0';
          loadStats();
        }
      } catch (e) {
        showMessage(`‚ùå Hata: ${e.message}`, 'error');
      }
    }

    async function loadHistory() {
      try {
        const res = await fetch('/api/sms');
        const data = await res.json();
        const list = document.getElementById('historyList');

        if (data.sms.length === 0) {
          list.innerHTML = '<div class="empty-state">SMS yok</div>';
          return;
        }

        list.innerHTML = data.sms.map(sms => `
          <div class="sms-item">
            <div class="sms-info">
              <div class="sms-phone">${sms.phone}</div>
              <div class="sms-message">${sms.message}</div>
              <div class="sms-time">${new Date(sms.timestamp).toLocaleString('tr-TR')}</div>
            </div>
            <div class="sms-actions">
              <button class="btn btn-danger" onclick="deleteSMS('${sms.id}')">Sil</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        document.getElementById('historyList').innerHTML = `<div class="empty-state">Hata: ${e.message}</div>`;
      }
    }

    async function deleteSMS(id) {
      try {
        await fetch(`/api/sms/${id}`, { method: 'DELETE' });
        loadHistory();
        loadStats();
      } catch (e) {
        showMessage(`‚ùå Hata: ${e.message}`, 'error');
      }
    }

    async function clearAllSMS() {
      if (!confirm('T√ºm SMS\'leri silmek istediƒüinize emin misiniz?')) return;

      try {
        await fetch('/api/sms', { method: 'DELETE' });
        loadHistory();
        loadStats();
        showMessage('‚úÖ T√ºm SMS silindi', 'success');
      } catch (e) {
        showMessage(`‚ùå Hata: ${e.message}`, 'error');
      }
    }

    async function loadStats() {
      try {
        const res = await fetch('/api/sms/stats');
        const data = await res.json();

        document.getElementById('stats').innerHTML = `
          <div class="stat">
            <div class="stat-value">${data.total}</div>
            <div class="stat-label">Toplam SMS</div>
          </div>
          <div class="stat">
            <div class="stat-value">${data.today}</div>
            <div class="stat-label">Bug√ºn</div>
          </div>
          <div class="stat">
            <div class="stat-value">${data.byType.manual}</div>
            <div class="stat-label">Manual</div>
          </div>
          <div class="stat">
            <div class="stat-value">${data.byType.automated}</div>
            <div class="stat-label">Otomatik</div>
          </div>
        `;
      } catch (e) {
        console.error(e);
      }
    }

    async function saveTemplate() {
      const name = document.getElementById('templateName').value.trim();
      const message = document.getElementById('templateMessage').value.trim();

      if (!name || !message) {
        showMessage('‚ùå ƒ∞sim ve mesaj gerekli', 'error');
        return;
      }

      try {
        const res = await fetch('/api/templates', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, message })
        });

        const data = await res.json();
        if (data.success) {
          showMessage('‚úÖ ≈ûablon kaydedildi', 'success');
          document.getElementById('templateName').value = '';
          document.getElementById('templateMessage').value = '';
          loadTemplates();
        }
      } catch (e) {
        showMessage(`‚ùå Hata: ${e.message}`, 'error');
      }
    }

    async function loadTemplates() {
      try {
        const res = await fetch('/api/templates');
        const data = await res.json();
        const list = document.getElementById('templatesList');

        if (data.templates.length === 0) {
          list.innerHTML = '<div class="empty-state">≈ûablon yok</div>';
          return;
        }

        list.innerHTML = data.templates.map(t => `
          <div class="template-item">
            <div>
              <div class="template-name">${t.name}</div>
              <div style="font-size: 12px; color: #999; margin-top: 5px;">${t.message}</div>
            </div>
            <div style="display: flex; gap: 5px;">
              <button class="btn btn-secondary" onclick="useTemplate('${t.name}', '${t.message.replace(/'/g, "\\'")}')">Kullan</button>
              <button class="btn btn-danger" onclick="deleteTemplate('${t.id}')">Sil</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        console.error(e);
      }
    }

    function useTemplate(name, message) {
      messageTextEl.value = message;
      charCountEl.textContent = message.length;
      document.querySelectorAll('.tab-btn')[0].click();
      phoneEl.focus();
    }

    async function deleteTemplate(id) {
      try {
        await fetch(`/api/templates/${id}`, { method: 'DELETE' });
        loadTemplates();
      } catch (e) {
        showMessage(`‚ùå Hata: ${e.message}`, 'error');
      }
    }

    // Initial load
    loadStats();
  </script>
</body>
</html>
